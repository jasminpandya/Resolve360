<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Resolve360 Support</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    .kanban-column {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    }
    .kanban-card {
      background-color: #ffffff;
      border: none;
      border-left: 5px solid;
      border-radius: 5px;
      margin-bottom: 10px;
      padding: 10px;
      cursor: pointer;
    }
    .kanban-card:hover {
      background-color: #f1f1f1;
      transform: scale(1.01);
    }
    .border-new { border-color: #0d6efd; }
    .border-progress { border-color: #ffc107; }
    .border-completed { border-color: #198754; }

    .navbar {
      background-color: #ffffff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .profile-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
      cursor: pointer;
    }

    .dropdown-menu {
      min-width: 250px;
    }

    .dropdown-header {
      font-weight: bold;
    }
    .complaint-details {
  background: #f8f9fa;
  border-radius: 8px;
  padding: 15px;
  font-size: 1rem;
  box-shadow: 0 2px 4px rgba(0,0,0,0.04);
}
.complaint-details-table {
  width: 100%;
}
.complaint-details-table th {
  text-align: left;
  width: 30%;
  color: #495057;
  font-weight: 500;
  padding-right: 10px;
}
.complaint-details-table td {
  color: #212529;
  padding-bottom: 8px;
}
#editStatusBtn {
  margin-right: 10px;
}
.modal-header .modal-title {
  margin-left: 0.5rem;
}
  </style>
</head>
<body>
  <!-- Top Navbar -->
  <nav class="navbar navbar-light px-4">
    <a class="navbar-brand" href="#"><strong>Resolve360 Support</strong></a>
    <div class="dropdown">
      <img src="{{ url_for('static', filename='images/user-avatar.png') }}" alt="Profile" class="profile-avatar dropdown-toggle" data-bs-toggle="dropdown" />
      <ul class="dropdown-menu dropdown-menu-end">
        <li class="dropdown-header">Profile</li>
        <li><span class="dropdown-item-text">Email: {{ email }}</span></li>
        <li><span class="dropdown-item-text">Role: {{ support }}</span></li>
        <li><hr class="dropdown-divider"></li>
        <li><a class="dropdown-item text-danger" href="{{ url_for('logoutsupport') }}">Logout</a></li>
      </ul>
    </div>
  </nav>

  <!-- Kanban Section -->
  <div class="container py-4">
    <div class="row g-3">
      <div class="col-md-4">
        <div class="kanban-column">
          <h5 class="text-primary">üÜï New</h5>
          {% for item in complaints.new %}
            <div class="kanban-card border-new" data-complaint='{{ item | tojson | safe }}' onclick="showDetails(JSON.parse(this.getAttribute('data-complaint')))">
              <b>ID</b>: {{ item.id }} <br/>
              <b>Title</b>: {{ item.title }} <br/>
              <b>Raised on Date</b>: {{ item.created_at }}
            </div>
          {% endfor %}
        </div>
      </div>
      <div class="col-md-4">
        <div class="kanban-column">
          <h5 class="text-warning">‚öôÔ∏è In Progress</h5>
          {% for item in complaints.in_progress %}
            <div class="kanban-card border-progress" data-complaint='{{ item | tojson | safe }}' onclick="showDetails(JSON.parse(this.getAttribute('data-complaint')))">
              <b>ID</b>: {{ item.id }} <br/>
              <b>Title</b>: {{ item.title }} <br/>
              <b>Raised on Date</b>: {{ item.created_at }}
            </div>
          {% endfor %}
        </div>
      </div>
      <div class="col-md-4">
        <div class="kanban-column">
          <h5 class="text-success">‚úÖ Completed</h5>
          {% for item in complaints.completed %}
            <div class="kanban-card border-completed" data-complaint='{{ item | tojson | safe }}' onclick="showDetails(JSON.parse(this.getAttribute('data-complaint')))">
              <b>ID</b>: {{ item.id }} <br/>
              <b>Title</b>: {{ item.title }} <br/>
              <b>Raised on Date</b>: {{ item.created_at }}
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>

  <!-- Complaint Modal -->
  <div class="modal fade" id="complaintModal" tabindex="-1" aria-labelledby="complaintModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title flex-grow-1 mb-0" id="complaintModalLabel">Complaint Details</h5>
          
        </div>
        <div class="modal-body">
  <div id="complaintText" class="complaint-details"></div>
  <hr />
  <div id="analysisResult" class="small text-dark"></div>
</div>
        <div class="modal-footer">
          <button class="btn btn-outline-primary" onclick="analyze()">Analyze</button>
          <button class="btn btn-outline-primary" onclick="editStatus()" id="editStatusBtn">
    Edit Status
  </button>
          <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let currentComplaint = "";
    function editStatus() {
  alert("Edit status functionality coming soon!");
  // You can implement a dropdown or modal for status update here.
}
    function showDetails(obj) {
  currentComplaint = obj;
  document.getElementById("complaintText").innerHTML =
    `<table class="complaint-details-table">
      <tr><th>ID:</th><td>${obj.id}</td></tr>
      <tr><th>Title:</th><td>${obj.title}</td></tr>
      <tr><th>Description:</th><td>${obj.description}</td></tr>
      <tr><th>Raised by:</th><td>${obj.raised_by}</td></tr>
      <tr><th>Assigned to:</th><td>${obj.assigned_to_group}</td></tr>
      <tr><th>Created at:</th><td>${obj.created_at}</td></tr>
    </table>`;
  document.getElementById("analysisResult").innerHTML = "";
  new bootstrap.Modal(document.getElementById("complaintModal")).show();
}

    function analyze() {
      fetch('/analyze', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ complaint: currentComplaint })
      })
      .then(res => res.json())
      .then(data => {
        const result = `
          <strong>Sentiment:</strong> ${data.sentiment}<br>
          <strong>Priority:</strong> ${data.priority}<br>
          <strong>Category:</strong> ${data.category}<br>
          <strong>Notes:</strong> ${data.notes}
        `;
        document.getElementById("analysisResult").innerHTML = result;
      })
      .catch(err => {
        document.getElementById("analysisResult").innerText = "Error analyzing complaint.";
      });
    }
  </script>
</body>
</html>
